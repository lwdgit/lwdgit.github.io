webpackJsonp([5,3],{0:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;var o=n(3),a=r(o),i=n(207),s=r(i),u=n(97),l=r(u);n(111);var c=n(197),d=r(c),f=n(77),h=r(f);n(113),a.default.use(s.default),a.default.use(l.default);var p=t.router=new s.default({routes:h.default,mode:"hash",linkActiveClass:"active"});p.beforeEach(function(e,t,n){if(e.matched.some(function(e){return e.meta.requiresAuth})){var r=localStorage.getItem("user")||sessionStorage.getItem("user");if(!r)return n({path:"/login",query:{redirect:e.fullPath}})}n()}),window.$bus=new a.default({render:function(e){return e(d.default)},router:p}).$mount("#app")},23:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(){localStorage.clear(),sessionStorage.clear()}function a(){try{t.user=l=JSON.parse(localStorage.getItem("user")||sessionStorage.getItem("user"))}catch(e){o()}t.user=l=l||{},l.name?(t.octo=c=new u.default({username:l.name,password:i.Base64.decode(l.password)}),t.repo=d=c.repos(l.name,"blog")):o()}Object.defineProperty(t,"__esModule",{value:!0}),t.getUser=t.user=t.repo=t.octo=void 0;var i=n(21),s=n(36),u=r(s),l={},c=null,d=null;t.octo=c,t.repo=d,t.user=l,t.getUser=a},24:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=r(o),i=new a.default;t.default=i},77:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=r(o),i=a.default.component("root",{template:"<router-view></router-view>"}),s=[{path:"/login",component:function(e){return n.e(1,function(t){var n=[t(201)];e.apply(null,n)}.bind(this))},name:"login",meta:{hidden:!0}},{path:"/404",component:function(e){return n.e(2,function(t){var n=[t(198)];e.apply(null,n)}.bind(this))},name:"404",meta:{requiresAuth:!0}},{path:"/",name:"root",component:i,meta:{requiresAuth:!0},children:[{path:"/",component:function(e){return n.e(0,function(t){var n=[t(200)];e.apply(null,n)}.bind(this))}},{path:"*",iconClass:"el-icon-document",type:"filelist"}]},{path:"*",redirect:{path:"/404"}}],u=s.length;s[u-2].children.forEach(function(e){e.children&&(e.meta||(e.meta={}),e.meta.children=e.children)}),t.default=s},78:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(199),a=r(o);t.default={data:function(){return{user:{name:"",avatar:""},openSideBar:!0,activeMenu:""}},components:{Filelist:a.default},created:function(){this.activeMenu=this.$route.name,this.setUser()},watch:{$route:function(e,t){this.activeMenu=this.$route.name,this.setUser()}},methods:{setUser:function(){try{this.user=JSON.parse(localStorage.getItem("user")||sessionStorage.getItem("user"))||{}}catch(e){this.user={}}},logout:function(){var e=this;this.$confirm("确定要注销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){localStorage.removeItem("user"),e.$router.push({path:"/login"})}).catch(function(){})}}}},79:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){for(var r=e.split("/"),o=n,a=0,i=r.length;a<i&&void 0!==o;a++){var s=r[a];a===i-1?o[s]=t:o=o[s]||{}}}function a(e,t){for(var n in e){var r=e[n],o=r._id,i=r._path,u=r._type,l=(0,s.default)(r,["_id","_path","_type"]),c={label:n,_id:o,_path:i,_type:u};for(var d in l){c.children=[],a(l,c.children);break}t.unshift(c)}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(83),s=r(i),u=n(23),l=n(24),c=r(l);t.default={data:function(){return{filelist:[],loading:!1,fileTree:[]}},mounted:function(){var e=this;setTimeout(function(){console.log(window.$bus),c.default.$on("updateFiles",e.fetchFiles)},1e3)},created:function(){(0,u.getUser)(),this.fetchFiles()},methods:{fetchFiles:function(){var e=this;u.octo&&(this.loading=!0,u.octo.fromUrl("https://api.github.com/repos/"+u.user.name+"/blog/git/trees/gh-pages?recursive=1").fetch().then(function(e){return e.tree.filter(function(e){return 0===e.path.indexOf("_posts")&&!/(\/media|\/\.|\/_)/.test(e.path)})}).then(function(t){e.loading=!1,e.filelist=t;var n={};t.forEach(function(e){o(e.path,{_id:e.sha,_path:e.path,_type:e.type},n)}),e.fileTree=[],a(n,e.fileTree),e.fileTree[0].label="我的文件夹"}).catch(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.loading=!1,e.$message.error(/"message": "([^"]+)/m.test(t.message)&&RegExp.$1||t.toString())}))},removeFile:function(e){var t=this;return this.$confirm("是否要删除此文章？").then(function(){return t.loading=!0,u.repo.contents(e._path).remove({message:"remove file",sha:e.sha})}).then(function(){return t.loading=!1,t.fetchFiles()}).catch(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.loading=!1,t.$message.error(/"message": "([^"]+)/m.test(e.message)&&RegExp.$1||e.toString())})},editFile:function(e){"tree"!==e._type&&this.$router.push({path:"/",query:{path:e._path}})},renderContent:function(e,t){var n=t.node,r=(t.data,t.store,[e("span",{class:"flex-1"},n.label)]);return e("span",{class:"flex flex-1"},r)}},watch:{"$route.query":function(e){var t=this,n=e.path,r=e.update;r&&(setTimeout(function(){return t.fetchFiles()},1500),this.$router.replace({path:"/",query:{path:n}}))}}}},111:function(e,t){},113:function(e,t){},114:function(e,t){},115:function(e,t){},197:function(e,t,n){n(115);var r=n(8)(n(78),n(204),null,null);e.exports=r.exports},199:function(e,t,n){n(114);var r=n(8)(n(79),n(202),null,null);e.exports=r.exports},202:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tree",{attrs:{data:e.fileTree,"node-key":"_path","render-content":e.renderContent,"default-expanded-keys":["_posts"]},on:{"node-click":e.editFile}})},staticRenderFns:[]}},204:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"admin"},[e.$route.meta.hidden?[n("router-view")]:[n("header",{staticClass:"admin-header"},[n("router-link",{staticClass:"logo",attrs:{to:{path:"/"}}},[e._v("极简博客管理系统")]),e._v(" "),e.user.name?n("div",{staticClass:"user-info"},[n("el-dropdown",{attrs:{trigger:"click"}},[n("span",{staticClass:"el-dropdown-link"},[n("span",[e._v(e._s(e.user.name))]),n("i",{staticClass:"el-icon-caret-bottom el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{slot:"dropdown"},[n("el-dropdown-item",[n("router-link",{staticClass:"logo",attrs:{to:{path:"../"}}},[e._v("返回首页")])],1),e._v(" "),n("el-dropdown-item",{nativeOn:{click:function(t){e.logout(t)}}},[e._v("注销")])],1)],1)],1):e._e()],1),e._v(" "),n("div",{staticClass:"admin-body"},[n("aside",{ref:"aside",staticClass:"admin-menu-wrapper"},[n("el-menu",{staticClass:"admin-menu-bar",attrs:{"default-active":e.activeMenu,router:""}},[e._l(e.$router.options.routes[e.$router.options.routes.length-2].children,function(t,r){return[t.children&&t.name?[n("el-submenu",{attrs:{index:t.name}},[n("template",{slot:"title"},[n("i",{class:t.iconClass}),e._v(e._s(t.name))]),e._v(" "),e._l(t.children,function(t,r){return n("el-menu-item",{key:t.name,attrs:{index:t.name,route:t}},[e._v(e._s(t.name))])})],2)]:e._e(),e._v(" "),!t.children&&t.name?[n("el-menu-item",{attrs:{index:t.name,route:t}},[n("i",{class:t.iconClass}),e._v(e._s(t.name))])]:e._e(),e._v(" "),"filelist"===t.type?[n("filelist")]:e._e()]})],2)],1),e._v(" "),n("div",{staticClass:"admin-content-wrapper"},[n("section",{staticClass:"admin-content"},[n("router-view")],1)])])]],2)},staticRenderFns:[]}}});
//# sourceMappingURL=app.caae71b4b28fdf909872.js.map